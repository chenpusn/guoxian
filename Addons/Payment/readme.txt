?????????weiphp??????????????????????????

1???????????????
2????????????????????????
3?????????????????????????????????????????????????????????????????

???????????????

??????????????????URL??????????????????????????????????????????????????????????????????¨°????????????????????????????????????????

1????????????

addons_url ( 'Payment://Alipay/pay', array (
					'from' => ?????????????????????addons_url????????Payment://Payment/playok?????? Shop://Wap/afterPlay,
					'orderName' => ????????,
					'price' => ??????,
					'token' => ?????token,
					'wecha_id' => ???openid,
					'paytype' => ??????????????????????????????,
					'orderid' => ???????,
					'bid' => ???ID,
					'sid' => ???ID
			) )


2??????????§µ?

<select name="zftype">                          
	<option value="1">?????</option>
	<option value="2">????(WAP??????)</option>
	<option value="3">????(???????)</option>
	<option value="0">??????</option>
	<option value="4">????????</option>
</select>


3???????PHP demo?????


	/**
	 * ********************????????????????????????????¦Ê????????????????***********************
	 */
	public function testpay() {
		if (IS_POST) {
			header ( "Content-type: text/html; charset=utf-8" );
			// token
			$token = get_token ();
			// ??????ID
			$openid = get_openid ();
			// ????????
			$orderName = urlencode ( "???????????" );
			// ????ID
			$orderid = date ( 'Ymd' ) . substr ( implode ( NULL, array_map ( 'ord', str_split ( substr ( uniqid (), 7, 13 ), 1 ) ) ), 0, 8 );
			// ??????
			$price = $_POST ['zfje'];
			// ???????
			$zftype = $_POST ['zftype'];
			/*
			 * ????????????? addons_url????
			 * ????GET????:token,wecha_id,orderid
			 * ??????playok?????????????????????????????????????
			 */
			$from = "Payment://Payment/playok";
			$bid = "";
			$sid = "";
			redirect ( addons_url ( 'Payment://Alipay/pay', array (
					'from' => $from,
					'orderName' => $orderName,
					'price' => $price,
					'token' => $token,
					'wecha_id' => $openid,
					'paytype' => $zftype,
					'orderid' => $orderid,
					'bid' => $bid,
					'sid' => $sid 
			) ), 1, '????,??????????????,????????????,????????...' );
		} else {
			$normal_tips = '???????????';
			$this->assign ( 'normal_tips', $normal_tips );
			$this->display ( "testpay" );
		}
	}
	public function playok() {
		// ??????????????????§µ?
		$token = I ( 'token' );
		$openid = I ( 'wecha_id' );
		$orderid = I ( 'orderid' );
		
		// TODO ????????????????????????????
		
		$this->success ( '????????', U ( 'lists' ) );
	}